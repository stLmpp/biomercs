<div class="player-info">
  <div class="name">
    <bio-icon [flag]="post().shortNameRegion" small [bioTooltip]="post().nameRegion"></bio-icon>
    <a [routerLink]="['/player', post().idPlayer]">{{ post().personaNamePlayer }}</a>
  </div>
  @let isOnline = isOnline$ | async;
  <div class="status">
    <span class="indicator" [class.online]="isOnline" [class.offline]="!isOnline"></span>
    {{ isOnline ? 'Online' : 'Offline' }}
  </div>
  <div class="posts">Posts: {{ post().postCount | number: '1.0-0' }}</div>
  <div class="avatar">
    <bio-player-avatar [personaName]="post().personaNamePlayer" [avatar]="post().avatarPlayer"></bio-player-avatar>
  </div>
</div>
<form class="post" [controlGroup]="form" (groupSubmit)="save()">
  <div class="header">
    <span class="title">
      @if (!editing) {
        {{ post().name }}
      } @else {
        <bio-form-field label="Name">
          <input bioInput controlName="name" placeholder="Name" />
          <bio-hint end>{{ (name$ | asyncDefault: '').length }} / 500</bio-hint>
          <bio-errors>
            <bio-error *error="'required'">Name is required</bio-error>
          </bio-errors>
        </bio-form-field>
      }
    </span>
    @if (!editing) {
      <div class="actions">
        @if (!topicLocked() && !post().deletedDate) {
          <button bioButton type="button" (click)="postQuote.emit(post())" [disabled]="loadingReply()">
            <bio-icon>format_quote</bio-icon>
            Quote
          </button>
        }
        @if (post().editAllowed) {
          <button bioButton type="button" (click)="openEdit()">
            <bio-icon>edit</bio-icon>
            Edit
          </button>
        }
        @if (post().deleteAllowed) {
          <button bioButton type="button" (click)="delete()">
            <bio-icon>delete</bio-icon>
            Delete
          </button>
        }
      </div>
    }
  </div>
  <div class="content">
    @if (!editing) {
      <ckeditor-view [content]="post().content"></ckeditor-view>
    } @else {
      <ckeditor [editor]="editor" controlName="content"></ckeditor>
      <div class="actions">
        <button primary bioButton type="button" (click)="closeEdit()" [disabled]="saving">Cancel</button>
        <button primary bioButton type="submit" [loading]="saving" [disabled]="form.pristine">Save</button>
      </div>
    }
  </div>
</form>

<h4 bioPageTitle></h4>
<ng-container *ngLet="{ hasMode: hasIdMode$ | async } as state">
  <bio-card class="params" collapsable>
    <h3 bioCardTitle>Parameters</h3>
    <bio-card-content>
      <bio-params
        [params]="form.valueChanges$ | async"
        (paramsChange)="form.patchValue($event)"
        [config]="paramsConfig"
        setQueryParamsOnChange
      ></bio-params>
    </bio-card-content>
  </bio-card>
  <form [controlGroup]="form" (groupSubmit)="onSubmit()">
    <ng-container
      *ngFor="
        let scorePlayerControl of scorePlayersControl;
        trackBy: trackByScorePlayerControl;
        let $index = index;
        let $first = first
      "
    >
      <bio-score-add-player
        *ngIf="scorePlayerControl.value$ | async as player"
        [disabled]="!state.hasMode"
        (hostChange)="hostChange($index)"
        (playerChange)="scorePlayerControl.setValue($event)"
        [player]="player"
        [characters]="characters$ | async"
        [charactersLoading]="characterLoading$ | async"
        [first]="$first"
        [playerNumber]="$index + 1"
      ></bio-score-add-player>
    </ng-container>
    <bio-card class="score-params" collapsable>
      <h3 bioCardTitle>Score info</h3>
      <bio-card-content>
        <form-field label="Score" [disabled]="!state.hasMode">
          <input bioInput controlName="score" bioCurrencyMask placeholder="Score" autocomplete="off" />
          <errors>
            <error *error="'required'">Score is required</error>
          </errors>
        </form-field>
        <form-field label="Max combo" [disabled]="!state.hasMode">
          <input bioInput controlName="maxCombo" type="number" autocomplete="off" />
          <errors>
            <error *error="'required'">Max combo is required</error>
            <error *error="'min'">Max combo can't be negative</error>
            <error *error="'max'">Max combo can surpass 400</error>
          </errors>
        </form-field>
        <form-field label="Time" [disabled]="!state.hasMode">
          <input
            bioInput
            controlName="time"
            [bioMask]="maskEnum.time"
            [dropSpecialCharacters]="false"
            [patterns]="maskTimePattern"
            autocomplete="off"
          />
          <errors>
            <error *error="'required'">Time is required</error>
          </errors>
        </form-field>
      </bio-card-content>
      <bio-card-actions>
        <button bioButton type="button" primary (click)="onReset()">Reset</button>
        <div class="submit-wrapper" (mouseenter)="onMouseenterCardActions()">
          <button bioButton type="submit" primary [disabled]="form.invalid || (submitModalLoading$ | async)">
            Submit
          </button>
        </div>
      </bio-card-actions>
    </bio-card>
  </form>
</ng-container>
